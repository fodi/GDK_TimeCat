{
	"name": "fLevel ðŸŽ¬",
	"events": [
		{
			"functionName": "prepareLevel",
			"functionDescription": "",
			"functionCategory": "",
			"functionReturnType": "none",
			"functionCopyPicked": false,
			"functionIsAsync": false,
			"functionParameters": [],
			"eventType": "function-block",
			"conditions": [],
			"actions": [
				{
					"type": "comment",
					"text": "Dynamically spawn things, apply level rules"
				}
			],
			"sid": 551882248979971,
			"children": [
				{
					"eventType": "block",
					"conditions": [],
					"actions": [
						{
							"type": "comment",
							"text": "Apply rules (within hardcoded limits)"
						},
						{
							"id": "set-eventvar-value",
							"objectClass": "System",
							"sid": 139245888955545,
							"parameters": {
								"variable": "R_Level_Rows",
								"value": "clamp(int(Functions.Rules_getNumber(PARAM_Tile_RowCount)), C_Level_Dimension_Min, C_Level_Dimension_Max)"
							}
						},
						{
							"id": "set-eventvar-value",
							"objectClass": "System",
							"sid": 584776617241278,
							"parameters": {
								"variable": "R_Level_Columns",
								"value": "clamp(int(Functions.Rules_getNumber(PARAM_Tile_ColumnCount)), C_Level_Dimension_Min, C_Level_Dimension_Max)"
							}
						},
						{
							"id": "set-eventvar-value",
							"objectClass": "System",
							"sid": 323236367236017,
							"parameters": {
								"variable": "R_Level_Tile_Reveal_Time",
								"value": "Functions.Rules_getNumber(PARAM_Tile_Time)"
							}
						},
						{
							"id": "log",
							"objectClass": "Browser",
							"sid": 606519280005235,
							"parameters": {
								"type": "log",
								"message": "StringSub(\"Generating {0} x {1} level.\", R_Level_Columns, R_Level_Rows)"
							}
						},
						{
							"type": "comment",
							"text": "Calculate and store level midpoint & \"far\" distance"
						},
						{
							"id": "set-eventvar-value",
							"objectClass": "System",
							"sid": 703069639011932,
							"parameters": {
								"variable": "midX",
								"value": "R_Level_Columns * C_Level_Grid_Size * 0.5"
							}
						},
						{
							"id": "set-eventvar-value",
							"objectClass": "System",
							"sid": 828775838793391,
							"parameters": {
								"variable": "midY",
								"value": "R_Level_Rows * C_Level_Grid_Size * 0.5"
							}
						},
						{
							"id": "set-eventvar-value",
							"objectClass": "System",
							"sid": 102436028624667,
							"parameters": {
								"variable": "distanceFar",
								"value": "max(midX + C_Level_Grid_Size * 2, midY + C_Level_Grid_Size * 2)"
							}
						},
						{
							"type": "comment",
							"text": "Spawn \"textures\" (including icons)"
						},
						{
							"id": "create-object",
							"objectClass": "System",
							"sid": 118846807200647,
							"parameters": {
								"object-to-create": "UI_Icons",
								"layer": "LAYER_UI",
								"x": "0",
								"y": "-1000",
								"create-hierarchy": false,
								"template-name": "\"\""
							}
						},
						{
							"type": "comment",
							"text": "Reset available player colours"
						},
						{
							"id": "split-string",
							"objectClass": "arrAvailablePlayerColors",
							"sid": 300816214904284,
							"parameters": {
								"string": "C_CSV_Colors_Name",
								"separator": "\",\"",
								"type": "string"
							}
						},
						{
							"id": "pop",
							"objectClass": "arrAvailablePlayerColors",
							"sid": 597543886577805,
							"parameters": {
								"where": "front",
								"axis": "x"
							}
						},
						{
							"type": "comment",
							"text": "Dynamically spawn things"
						},
						{
							"customAction": "spawn",
							"objectClass": "CameraHelper",
							"sid": 948272544472166
						},
						{
							"customAction": "spawnAll",
							"objectClass": "Wall",
							"sid": 655584556435110
						},
						{
							"customAction": "spawn",
							"objectClass": "Basemap",
							"sid": 954492913769098
						},
						{
							"customAction": "spawnAll",
							"objectClass": "Tile",
							"customActionObjectClass": "fTile",
							"sid": 536946566765191,
							"parameters": [
								"R_Level_Columns",
								"R_Level_Rows",
								"clamp(int(Functions.Rules_getNumber(PARAM_Tile_GapPercent)), 0, 100)"
							]
						},
						{
							"type": "comment",
							"text": "Wait for spawns and randomize tile symbols"
						},
						{
							"id": "wait-for-previous-actions",
							"objectClass": "System",
							"sid": 504839884268299
						},
						{
							"customAction": "randomizeSymbols",
							"objectClass": "Tile",
							"customActionObjectClass": "fTile",
							"sid": 720023268420973
						}
					],
					"sid": 700019727002712
				}
			]
		},
		{
			"functionName": "startLevel",
			"functionDescription": "",
			"functionCategory": "",
			"functionReturnType": "none",
			"functionCopyPicked": false,
			"functionIsAsync": false,
			"functionParameters": [],
			"eventType": "function-block",
			"conditions": [],
			"actions": [
				{
					"type": "comment",
					"text": "Start global timers when first player joins"
				}
			],
			"sid": 411310852850741,
			"children": [
				{
					"eventType": "block",
					"conditions": [],
					"actions": [
						{
							"id": "start-timer",
							"objectClass": "GlobalTimer",
							"sid": 534031228863031,
							"behaviorType": "Timer",
							"parameters": {
								"duration": "C_Cannon_FirstSpawnDelay",
								"type": "once",
								"tag": "TIMER_Cannon_Spawn"
							}
						},
						{
							"id": "start-timer",
							"objectClass": "GlobalTimer",
							"sid": 292531329924352,
							"behaviorType": "Timer",
							"parameters": {
								"duration": "1",
								"type": "regular",
								"tag": "TIMER_Level_EverySecond"
							}
						}
					],
					"sid": 698328570277481
				}
			]
		},
		{
			"functionName": "endLevel",
			"functionDescription": "",
			"functionCategory": "",
			"functionReturnType": "none",
			"functionCopyPicked": false,
			"functionIsAsync": false,
			"functionParameters": [],
			"eventType": "function-block",
			"conditions": [],
			"actions": [
				{
					"type": "comment",
					"text": "Show end of level UI (after win/stalemate condition)"
				},
				{
					"id": "log",
					"objectClass": "Browser",
					"sid": 492738207087861,
					"parameters": {
						"type": "log",
						"message": "\"[endLevel]\""
					}
				}
			],
			"sid": 710425574341323,
			"children": [
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "compare-eventvar",
							"objectClass": "System",
							"sid": 659490502039144,
							"parameters": {
								"variable": "hasLevelEnded",
								"comparison": 0,
								"value": "NO"
							}
						}
					],
					"actions": [],
					"sid": 450069422782248,
					"children": [
						{
							"eventType": "block",
							"conditions": [],
							"actions": [
								{
									"id": "stop-timer",
									"objectClass": "Cannon",
									"sid": 358986966047905,
									"behaviorType": "Timer",
									"parameters": {
										"tag": "TIMER_Cannon_Attack"
									}
								},
								{
									"id": "stop-all-timers",
									"objectClass": "GlobalTimer",
									"sid": 969892520526371,
									"behaviorType": "Timer"
								},
								{
									"id": "set-eventvar-value",
									"objectClass": "System",
									"sid": 145809337330651,
									"parameters": {
										"variable": "hasLevelEnded",
										"value": "YES"
									}
								}
							],
							"sid": 499689925399229
						},
						{
							"eventType": "comment",
							"text": "Stop animation of non-dead players"
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "compare-instance-variable",
									"objectClass": "Player",
									"sid": 797751854008370,
									"parameters": {
										"instance-variable": "isDead",
										"comparison": 0,
										"value": "NO"
									}
								},
								{
									"id": "pick-children",
									"objectClass": "Player",
									"sid": 177207799917617,
									"parameters": {
										"child": "bbPlayer",
										"which": "own"
									}
								}
							],
							"actions": [
								{
									"id": "set-animation-frame",
									"objectClass": "bbPlayer",
									"sid": 673390930598908,
									"parameters": {
										"frame-number": "FRAME_Avatar_Standing"
									}
								},
								{
									"id": "stop-animation",
									"objectClass": "bbPlayer",
									"sid": 336908980802203
								}
							],
							"sid": 143298983412002
						},
						{
							"eventType": "comment",
							"text": "Calculate and display final results"
						},
						{
							"eventType": "variable",
							"name": "listPlayers",
							"type": "string",
							"initialValue": "",
							"comment": "",
							"isStatic": false,
							"isConstant": false,
							"sid": 603897774466968
						},
						{
							"eventType": "variable",
							"name": "listPairs",
							"type": "string",
							"initialValue": "",
							"comment": "",
							"isStatic": false,
							"isConstant": false,
							"sid": 190223943321980
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "for-each-ordered",
									"objectClass": "System",
									"sid": 193157789480809,
									"parameters": {
										"object": "Player",
										"expression": "Player.pairsFound",
										"order": "descending"
									}
								}
							],
							"actions": [
								{
									"id": "add-to-eventvar",
									"objectClass": "System",
									"sid": 100384028333803,
									"parameters": {
										"variable": "listPlayers",
										"value": "\"[color=#\" & trim(tokenat(C_CSV_Colors_Hex, Player.playerId, \",\")) & \"]\" & trim(tokenat(C_CSV_Colors_Name, Player.playerId, \",\")) & \" TimeCat:[/color] \" & newline"
									}
								},
								{
									"id": "add-to-eventvar",
									"objectClass": "System",
									"sid": 687474592801202,
									"parameters": {
										"variable": "listPairs",
										"value": "\"[color=#\" & trim(tokenat(C_CSV_Colors_Hex, Player.playerId, \",\")) & \"]\" & zeropad(Player.pairsFound, len(str(R_Level_Rows * R_Level_Columns))) & \"[/color] \" & newline\n"
									}
								}
							],
							"sid": 863260826281066
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "compare-instance-variable",
									"objectClass": "UI_TextSF",
									"sid": 660808550461788,
									"parameters": {
										"instance-variable": "role",
										"comparison": 0,
										"value": "ROLE_GameOver_Players"
									}
								}
							],
							"actions": [
								{
									"id": "set-text",
									"objectClass": "UI_TextSF",
									"sid": 943109537983407,
									"parameters": {
										"text": "listPlayers"
									}
								}
							],
							"sid": 149749201779701
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "compare-instance-variable",
									"objectClass": "UI_TextSF",
									"sid": 615852394284696,
									"parameters": {
										"instance-variable": "role",
										"comparison": 0,
										"value": "ROLE_GameOver_Pairs"
									}
								}
							],
							"actions": [
								{
									"id": "set-text",
									"objectClass": "UI_TextSF",
									"sid": 660627425274636,
									"parameters": {
										"text": "listPairs"
									}
								}
							],
							"sid": 449146671899896
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "compare-instance-variable",
									"objectClass": "UI_TextSF",
									"sid": 684797768879284,
									"parameters": {
										"instance-variable": "role",
										"comparison": 0,
										"value": "ROLE_GameOver_Time"
									}
								}
							],
							"actions": [
								{
									"id": "set-text",
									"objectClass": "UI_TextSF",
									"sid": 670312115295356,
									"parameters": {
										"text": "\"Time elapsed: \" & Functions.formatTime(timeElapsed)"
									}
								}
							],
							"sid": 222155649119255
						},
						{
							"eventType": "comment",
							"text": "todo showexit/restart button"
						},
						{
							"eventType": "block",
							"conditions": [],
							"actions": [
								{
									"id": "set-layer-visible",
									"objectClass": "System",
									"sid": 887160100539620,
									"parameters": {
										"layer": "LAYER_UI_GameOver",
										"visibility": "visible"
									}
								},
								{
									"id": "set-layer-opacity",
									"objectClass": "System",
									"sid": 396575902865600,
									"parameters": {
										"layer": "LAYER_UI_GameOver",
										"opacity": "0"
									}
								},
								{
									"id": "tween-value",
									"objectClass": "GlobalTimer",
									"sid": 933452752044215,
									"behaviorType": "Tween",
									"parameters": {
										"tags": "TWEEN_Layer_UI_GameOver_FadeIn",
										"start-value": "0",
										"end-value": "100",
										"time": "2",
										"ease": "easeinoutsine",
										"destroy-on-complete": "no",
										"loop": "no",
										"ping-pong": "no",
										"repeat-count": "1"
									}
								}
							],
							"sid": 462155073579385
						}
					]
				}
			]
		},
		{
			"functionName": "checkStalemate",
			"functionDescription": "",
			"functionCategory": "",
			"functionReturnType": "none",
			"functionCopyPicked": false,
			"functionIsAsync": false,
			"functionParameters": [],
			"eventType": "function-block",
			"conditions": [],
			"actions": [
				{
					"type": "comment",
					"text": "When all enabled tiles are opened as the first part of pairs (by different players), end level"
				}
			],
			"sid": 542560633857791,
			"children": [
				{
					"eventType": "variable",
					"name": "enabledTileCount",
					"type": "number",
					"initialValue": "0",
					"comment": "",
					"isStatic": false,
					"isConstant": false,
					"sid": 536031174416077
				},
				{
					"eventType": "comment",
					"text": "Check for a stalemate"
				},
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "compare-eventvar",
							"objectClass": "System",
							"sid": 640983160056263,
							"parameters": {
								"variable": "hasLevelEnded",
								"comparison": 0,
								"value": "NO"
							}
						},
						{
							"id": "is-animation-playing",
							"objectClass": "fTile",
							"sid": 682556398914890,
							"parameters": {
								"animation": "ANIM_Tile_Enabled"
							}
						}
					],
					"actions": [
						{
							"id": "set-eventvar-value",
							"objectClass": "System",
							"sid": 790730340463337,
							"parameters": {
								"variable": "enabledTileCount",
								"value": "fTile.PickedCount"
							}
						}
					],
					"sid": 575955267471001,
					"children": [
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "compare-instance-variable",
									"objectClass": "fTile",
									"sid": 711451607147351,
									"parameters": {
										"instance-variable": "pairPart",
										"comparison": 0,
										"value": "1"
									}
								},
								{
									"id": "compare-eventvar",
									"objectClass": "System",
									"sid": 773615507629036,
									"parameters": {
										"variable": "enabledTileCount",
										"comparison": 0,
										"value": "fTile.PickedCount"
									}
								}
							],
							"actions": [
								{
									"id": "log",
									"objectClass": "Browser",
									"sid": 406715241336255,
									"parameters": {
										"type": "log",
										"message": "\"Stalemate\""
									}
								},
								{
									"id": "start-timer",
									"objectClass": "GlobalTimer",
									"sid": 923243033229186,
									"behaviorType": "Timer",
									"parameters": {
										"duration": "2",
										"type": "once",
										"tag": "TIMER_Level_End"
									}
								}
							],
							"sid": 640350976530176
						}
					]
				}
			]
		},
		{
			"functionName": "togglePause",
			"functionDescription": "",
			"functionCategory": "",
			"functionReturnType": "none",
			"functionCopyPicked": false,
			"functionIsAsync": false,
			"functionParameters": [],
			"eventType": "function-block",
			"conditions": [],
			"actions": [
				{
					"type": "comment",
					"text": "Pause / unpause game"
				}
			],
			"sid": 809940863427421,
			"children": [
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "compare-eventvar",
							"objectClass": "System",
							"sid": 519553485005798,
							"parameters": {
								"variable": "hasLevelEnded",
								"comparison": 0,
								"value": "NO"
							}
						}
					],
					"actions": [],
					"sid": 965248633065216,
					"children": [
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "compare-eventvar",
									"objectClass": "System",
									"sid": 552681680217280,
									"parameters": {
										"variable": "isPaused",
										"comparison": 0,
										"value": "NO"
									}
								}
							],
							"actions": [
								{
									"id": "set-eventvar-value",
									"objectClass": "System",
									"sid": 253789858326129,
									"parameters": {
										"variable": "isPaused",
										"value": "YES"
									}
								},
								{
									"id": "set-time-scale",
									"objectClass": "System",
									"sid": 598357348710767,
									"parameters": {
										"time-scale": "0"
									}
								}
							],
							"sid": 153441686495358
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "else",
									"objectClass": "System",
									"sid": 865156384066460
								}
							],
							"actions": [
								{
									"id": "set-eventvar-value",
									"objectClass": "System",
									"sid": 355552254278054,
									"parameters": {
										"variable": "isPaused",
										"value": "NO"
									}
								},
								{
									"id": "set-time-scale",
									"objectClass": "System",
									"sid": 278654996878909,
									"parameters": {
										"time-scale": "1"
									}
								}
							],
							"sid": 350332963767953
						}
					]
				}
			]
		}
	],
	"sid": 849818322627845
}